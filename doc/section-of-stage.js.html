<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: models/section-of-stage.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: models/section-of-stage.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>ï»¿/** @module */
define(['knockout',
    'models/file-spec',
    'services/file-spec'], function (ko, FileSpec, fileSpecService) {
        'use strict';

        /**
        * Import file specification to the list
        * @param {object} data - Server data with file specs
        */
        function importFileSpecs(data) {
            return data.map(function (item) { return new FileSpec(item); });
        }

        /**
        * Section base: sharep props for other types of sections - insert using call method
        * @constructor
        * @param {object} data - Section data
        */
        var exports = function (data, parentStage, idOfParentStage) {
            /** Alternative */
            var ths = this;

            /** Get parent (well) */
            this.getParent = function () {
                return parentStage;
            };

            /**
            * Id of parent stage of section. Duplicated in section.parentId and section.parent.id
            * @type {string}
            */
            this.idOfParentStage = idOfParentStage;

            /**
            * Stage, like 'well', 'wield', 'wroup', 'wegion', 'company'
            * @type {string}
            */
            var stageKey = ths.getParent().stageKey;

            /**
            * Section guid
            * @type {string}
            */
            this.id = data.Id;

            /**
            * Whether the section is visible as a view: can ovveride default checkbox from section pattern (isView)
            * @type {boolean}
            */
            this.isVisible = ko.observable(data.IsVisible);

            /**
            * Id of section pattern: contains info like section Name and other
            * @type {string}
            */
            this.sectionPatternId = data.SectionPatternId;

            /**
            * Section pattern (default name, file formats and other params for section)
            * @type {module:models/section-pattern}
            */
            this.sectionPattern = ko.computed({
                read: function () {
                    var tmpListOfSectionPattern = ko.unwrap(ths.getParent().stagePatterns);
                    var tmpSectionPatternId = ths.sectionPatternId;
                    var byId = tmpListOfSectionPattern.filter(function (arrElem) {
                        return arrElem.id === tmpSectionPatternId;
                    });

                    if (byId.length === 1) {
                        return byId[0];
                    }
                },
                deferEvaluation: true
            });

            /**
            * Whether section is visible as view: calculated using section checkbox and pattern checkbox
            * @type {boolean}
            */
            this.isVisibleAsView = ko.computed({
                read: function () {
                    var tmpSectionPattern = ko.unwrap(ths.sectionPattern);
                    var tmpIsVisible = ko.unwrap(ths.isVisible);
                    if (tmpSectionPattern) {
                        return tmpSectionPattern.isView && tmpIsVisible;
                    }
                    else {
                        return false;
                    }
                },
                deferEvaluation: true
            });

            /**
            * List of file specifications
            * @type {Array.&lt;module:models/file-spec>}
            */
            this.listOfFileSpec = ko.observableArray();

            /**
            * Sorted and filtered list of files: ready to view
            * @type {Array.&lt;module:models/file-spec>}
            */
            this.readyListOfFileSpec = ko.computed({
                read: function () {
                    var tmpList = ko.unwrap(ths.listOfFileSpec);
                    return tmpList.sort(function (a, b) {
                        return b.createdUnixTime - a.createdUnixTime;
                    });
                },
                deferEvaluation: true
            });

            /**
            * Whether files are loaded
            * @type {boolean}
            */
            this.isLoadedListOfFileSpec = ko.observable(false);

            /** Load list of file spec from the server */
            this.loadListOfFileSpec = function () {
                // Do not load if loaded already
                if (ko.unwrap(ths.isLoadedListOfFileSpec)) {
                    // Unselect all files in this section
                    var tmpListOfFileSpec = ko.unwrap(ths.listOfFileSpec);

                    tmpListOfFileSpec.forEach(function (elem) {
                        elem.isSelected(false);
                    });

                    return;
                }

                // Loaded files are unselected by default
                fileSpecService.get(stageKey, this.id).done(function (r) {
                    // Import data to objects
                    ths.listOfFileSpec(importFileSpecs(r));
                    // Set flag (do not load again)
                    ths.isLoadedListOfFileSpec(true);
                });
            };

            /** Get settings for file loader: only after defining of SectionPattern */
            this.getSectionFiloader = function () {
                return {
                    callback: function (result) {
                        ths.listOfFileSpec.push(new FileSpec(result[0]));
                    },
                    url: fileSpecService.getUrl(stageKey, this.id),
                    fileTypeRegExp: ko.unwrap(ths.sectionPattern).fileTypeRegExp
                };
            };

            /** Delete selected files from this section */
            this.deleteSelectedFileSpecs = function () {
                var tmpList = ko.unwrap(ths.listOfFileSpec);

                // Choose selected files
                var tmpSelectedList = tmpList.filter(function (elem) {
                    return ko.unwrap(elem.isSelected);
                });

                // Need to send to the server (only ids - to define and remove files on the server)
                var tmpIdList = tmpSelectedList.map(function (elem) {
                    return { id: elem.id };
                });

                // Remove from server
                fileSpecService.deleteArray(stageKey, ths.id, tmpIdList).done(function () {
                    // If success
                    // Remove from client file list (all selected files)
                    tmpSelectedList.forEach(function (elem) {
                        ths.listOfFileSpec.remove(elem);

                        updateSectionAfterRemovingFiles(ths.sectionPatternId);
                    });
                });
            };

            /**
            * Update section after removing files
            */
            function updateSectionAfterRemovingFiles(idOfSectionPattern) {
                switch (idOfSectionPattern) {
                    case 'well-volume':
                        ths.getParent().isLoadedVolumes(false);
                        ths.getParent().loadVolumes();
                        break;
                    case 'well-sketch':
                        ths.getParent().sketchOfWell.isLoaded(false);
                        ths.getParent().sketchOfWell.load();
                        break;
                    case 'well-history':
                        ths.getParent().isLoadedHistoryList(false);
                        ths.getParent().loadWellHistoryList();
                        break;
                }
            }

            /**
            * Delete file spec by id
            * @param {string} idOfFileSpec
            * @param {function} callback
            */
            this.deleteFileSpecById = function (idOfFileSpec, callback) {
                // Remove from server
                fileSpecService.deleteArray(stageKey, ths.id, [{ id: idOfFileSpec }]).done(function () {
                    // If success
                    // Remove from client file list if exists
                    var removedFileSpec = ths.getFileSpecById(idOfFileSpec);
                    if (removedFileSpec) {
                        ths.listOfFileSpec.remove(removedFileSpec);
                    }

                    if (callback) {
                        callback();
                    }
                });
            };

            /**
            * Get file spec by id
            * @param {string} idOfFileSpec
            */
            this.getFileSpecById = function (idOfFileSpec) {
                return ko.unwrap(ths.listOfFileSpec).filter(function (elem) {
                    return elem.id === idOfFileSpec;
                })[0];
            };

            /**
            * Whether any file is selected: to activate delete button or smth else
            * @type {boolean}
            */
            this.isSelectedAnyFile = ko.computed({
                read: function () {
                    var tmpList = ko.unwrap(ths.listOfFileSpec);

                    return tmpList.filter(function (elem) {
                        return ko.unwrap(elem.isSelected);
                    }).length > 0;
                },
                deferEvaluation: true
            });
        };

        return exports;
    });</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="all-bindings.html">bindings/all-bindings</a></li><li><a href="svg-bindings.html">bindings/svg-bindings</a></li><li><a href="stage-constants.html">constants/stage-constants</a></li><li><a href="svg-elem-type-constants.html">constants/svg-elem-type-constants</a></li><li><a href="ajax-request.html">helpers/ajax-request</a></li><li><a href="history-helper.html">helpers/history-helper</a></li><li><a href="log-helper.html">helpers/log-helper</a></li><li><a href="area-of-map-of-wield.html">models/area-of-map-of-wield</a></li><li><a href="column-attribute.html">models/column-attribute</a></li><li><a href="company.html">models/company</a></li><li><a href="employee.html">models/employee</a></li><li><a href="file-spec.html">models/file-spec</a></li><li><a href="file-spec-of-history-of-well.html">models/file-spec-of-history-of-well</a></li><li><a href="forecast-evolution.html">models/forecast-evolution</a></li><li><a href="history-of-well.html">models/history-of-well</a></li><li><a href="integrity-of-well.html">models/integrity-of-well</a></li><li><a href="job-type.html">models/job-type</a></li><li><a href="log-of-well.html">models/log-of-well</a></li><li><a href="map-of-wield.html">models/map-of-wield</a></li><li><a href="nodal-analysis-of-well.html">models/nodal-analysis-of-well</a></li><li><a href="perfomance-of-well.html">models/perfomance-of-well</a></li><li><a href="production-data.html">models/production-data</a></li><li><a href="prop-spec.html">models/prop-spec</a></li><li><a href="section-of-stage.html">models/section-of-stage</a></li><li><a href="section-pattern.html">models/section-pattern</a></li><li><a href="sketch-of-well.html">models/sketch-of-well</a></li><li><a href="svg-elem.html">models/svg-elem</a></li><li><a href="user-profile.html">models/user-profile</a></li><li><a href="volume-of-well.html">models/volume-of-well</a></li><li><a href="wegion.html">models/wegion</a></li><li><a href="well.html">models/well</a></li><li><a href="well-marker-of-map-of-wield.html">models/well-marker-of-map-of-wield</a></li><li><a href="wfm-image.html">models/wfm-image</a></li><li><a href="wfm-parameter.html">models/wfm-parameter</a></li><li><a href="wfm-parameter-of-wroup.html">models/wfm-parameter-of-wroup</a></li><li><a href="widget.html">models/widget</a></li><li><a href="widgock.html">models/widgock</a></li><li><a href="widgout.html">models/widgout</a></li><li><a href="wield.html">models/wield</a></li><li><a href="workspace.html">models/workspace</a></li><li><a href="wroup.html">models/wroup</a></li><li><a href="stage-base.html">models\bases/stage-base</a></li><li><a href="auth.html">services/auth</a></li><li><a href="company_.html">services/company</a></li><li><a href="company-user.html">services/company-user</a></li><li><a href="file-spec_.html">services/file-spec</a></li><li><a href="file-spec-of-history-of-well_.html">services/file-spec-of-history-of-well</a></li><li><a href="image-of-history-of-well.html">services/image-of-history-of-well</a></li><li><a href="integrity-of-well_.html">services/integrity-of-well</a></li><li><a href="log-of-well_.html">services/log-of-well</a></li><li><a href="map-of-wield_.html">services/map-of-wield</a></li><li><a href="nodal-analysis-of-well_.html">services/nodal-analysis-of-well</a></li><li><a href="register.html">services/register</a></li><li><a href="sketch-of-well_.html">services/sketch-of-well</a></li><li><a href="svg-elem-of-log-of-well.html">services/svg-elem-of-log-of-well</a></li><li><a href="volume-of-well_.html">services/volume-of-well</a></li><li><a href="wegion_.html">services/wegion</a></li><li><a href="well_.html">services/well</a></li><li><a href="well-marker-of-map-of-wield_.html">services/well-marker-of-map-of-wield</a></li><li><a href="widget_.html">services/widget</a></li><li><a href="widgout_.html">services/widgout</a></li><li><a href="wield_.html">services/wield</a></li><li><a href="wroup_.html">services/wroup</a></li><li><a href="company__.html">viewmodels/company</a></li><li><a href="employee_.html">viewmodels/employee</a></li><li><a href="history-of-well_.html">viewmodels/history-of-well</a></li><li><a href="integrity-of-well__.html">viewmodels/integrity-of-well</a></li><li><a href="log-of-well__.html">viewmodels/log-of-well</a></li><li><a href="map-of-wield__.html">viewmodels/map-of-wield</a></li><li><a href="map-tool.html">viewmodels/map-tool</a></li><li><a href="nodal-analysis-of-well__.html">viewmodels/nodal-analysis-of-well</a></li><li><a href="perfomance-of-well_.html">viewmodels/perfomance-of-well</a></li><li><a href="scope-of-history-of-well.html">viewmodels/scope-of-history-of-well</a></li><li><a href="section-of-stage_.html">viewmodels/section-of-stage</a></li><li><a href="sketch-of-well__.html">viewmodels/sketch-of-well</a></li><li><a href="user-profile_.html">viewmodels/user-profile</a></li><li><a href="volume-of-well__.html">viewmodels/volume-of-well</a></li><li><a href="wegion__.html">viewmodels/wegion</a></li><li><a href="well__.html">viewmodels/well</a></li><li><a href="well-marker-of-map-of-wield__.html">viewmodels/well-marker-of-map-of-wield</a></li><li><a href="widget__.html">viewmodels/widget</a></li><li><a href="widgock_.html">viewmodels/widgock</a></li><li><a href="widgout__.html">viewmodels/widgout</a></li><li><a href="wield__.html">viewmodels/wield</a></li><li><a href="workspace_.html">viewmodels/workspace</a></li><li><a href="wroup__.html">viewmodels/wroup</a></li><li><a href="stage-base_.html">viewmodels\bases/stage-base</a></li><li><a href="stage-child-base.html">viewmodels\bases/stage-child-base</a></li><li><a href="widget-default-summary.html">viewmodels\widgets/widget-default-summary</a></li><li><a href="widget-well-history.html">viewmodels\widgets/widget-well-history</a></li><li><a href="widget-well-perfomance.html">viewmodels\widgets/widget-well-perfomance</a></li><li><a href="widget-well-sketch.html">viewmodels\widgets/widget-well-sketch</a></li><li><a href="widget-wield-map.html">viewmodels\widgets/widget-wield-map</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Sat Feb 08 2014 01:08:26 GMT+0200 (EET)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
